<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BoxSnap V2 (Visual Search Fixed)</title>
    
    <script>
        window.onerror = function(msg, url, line) {
            var err = document.getElementById('error-display');
            var loader = document.getElementById('loading-screen');
            if(loader) loader.style.display = 'none';
            if(err) {
                err.style.display = 'block';
                err.innerHTML += "<strong>" + msg + "</strong><br><small>" + url + " (Line " + line + ")</small><br><br>";
            }
            return false;
        };
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <style>
        body { background-color: #f8fafc; font-family: system-ui, -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .box-card { transition: transform 0.1s ease-in-out; }
        .box-card:active { transform: scale(0.98); }
        .modal-prevent-touch { touch-action: none; }
        
        /* NEON HIGHLIGHT ANIMATION */
        @keyframes pulse-neon {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); border-color: #22c55e; background-color: rgba(34, 197, 94, 0.1); }
            50% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); border-color: #86efac; background-color: rgba(34, 197, 94, 0.3); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); border-color: #22c55e; background-color: rgba(34, 197, 94, 0.1); }
        }
        .neon-box {
            position: absolute;
            border: 3px solid #22c55e;
            animation: pulse-neon 1.5s infinite;
            z-index: 20;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="error-display" style="display:none; background: #fee2e2; color: #991b1b; padding: 20px; margin: 10px; border: 2px solid #b91c1c; border-radius: 8px; font-family: monospace; z-index: 99999; position: relative;"></div>

    <div id="loading-screen" style="height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #64748b;">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
        <h2 style="margin-top: 15px; font-weight: bold; font-size: 1.2rem;">Loading BoxSnap...</h2>
    </div>

    <div id="root"></div>

    <script type="text/babel">
        document.getElementById('loading-screen').style.display = 'none';

        try {
            const { useState, useEffect, useRef } = React;

            const Icon = ({ d, className="" }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d={d} /></svg>;
            const Icons = {
                arrowLeft: "m12 19-7-7 7-7 M19 12H5",
                camera: "M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z M12 13m-3 0a3 3 0 1 0 6 0a3 3 0 1 0-6 0",
                settings: "M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",
                check: "M20 6 9 17l-5-5",
                sparkles: "m12 3-1.9 5.8a2 2 0 0 1-1.2 1.2L3 12l5.8 1.9a2 2 0 0 1 1.2 1.2L12 21l1.9-5.8a2 2 0 0 1 1.2-1.2L21 12l-5.8-1.9a2 2 0 0 1-1.2-1.2L12 3z",
                trash: "M3 6h18 M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6 M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",
                plus: "M12 5v14 M5 12h14",
                package: "M16.5 9.4 7.5 4.21 M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z M3.3 7l8.7 5 8.7-5 M12 22v-10",
                search: "M11 19a8 8 0 1 0 0-16 8 8 0 0 0 0 16z M21 21l-4.35-4.35",
                scan: "M3 7V5a2 2 0 0 1 2-2h2 M17 3h2a2 2 0 0 1 2 2v2 M21 17v2a2 2 0 0 1-2
